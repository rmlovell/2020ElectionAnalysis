<!DOCTYPE html>
<html lang="en">
  <head>
		<meta charset="utf-8">
		<title>2020 US Election Tweets</title>
    <style>

      .states :hover {
        fill: gray;
      }
      
      .state-borders {
        fill: none;
        stroke: #fff;
        stroke-width: 0.5px;
        stroke-linejoin: round;
        stroke-linecap: round;
        pointer-events: none;
      }

      .row {
  display: flex;
}

  .column {
  flex: 50%;
}
  .buttons{
    position: absolute;
    top: 50px;
  }
  .tip{
    position: absolute;
    top: 150px;
  }

      </style>
      <script src="https://d3js.org/d3.v4.min.js"></script>
      <script src="https://d3js.org/topojson.v2.min.js"></script>
      <script src="https://d3js.org/d3-color.v2.min.js"></script>
      <script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
      <script src="https://d3js.org/d3-scale-chromatic.v2.min.js"></script>
    </head>

<body>
  <div class="row">
    <div class = "column">
      <svg width="960" height="600" id = "svg"></svg>
    <div class = "row">
    <svg width="240" height="250" id = "svg1"></svg>
    <svg width="240" height="250" id = "svg2"></svg>
    <svg width="240" height="250" id = "svg3"></svg>
    <svg width="240" height="250" id = "svg4"></svg>
    </div>
    </div>
    <div class = "column" >
      <div class = "buttons">
        <input type="radio" id="tweets" name="map" value="tweets" onclick="location.href='tweets_map.html'" checked = "true">
      <label for="male">Tweets</label><br>
      <input type="radio" id="sentiment" name="map" value="sentiment" onclick="location.href='sentiment_map.html'">
      <label for="female">Tweet Sentiment</label><br>
      <input type="radio" id="pop_vote" name="map" value="pop_vote" onclick="location.href='pop_vote_map.html'">
      <label for="other">Popular Vote</label>
      <br>
      <input type="radio" id="pop_vote" name="map" value="pop_vote" onclick="location.href='error_map.html'" >
      <label for="other">Error</label>
      </div>
      <div class = "tip">Mouse over states to view state-specific data</div>
    </div>
  </div>
  <div class = "row">

    <svg width="500" height="500" id = "svg5"></svg>
  </div>
<script>

var svg = d3.select("#svg");
var svg1 = d3.select("#svg1");
var svg2 = d3.select("#svg2");
var svg3 = d3.select("#svg3");
var svg4 = d3.select("#svg4");

var svg5 = d3.select("#svg5");
var path = d3.geoPath();

let tweets = {}; 
d3.csv('https://raw.githubusercontent.com/rmlovell/2020ElectionAnalysis/main/Datasets/count.csv', function(d){
  for (let i = 0; i < d.length; i++){
    tweets[d[i].st] = {"D" : d[i].count_x,  "R" : d[i].count_y, "percent" : d[i].percent};
  }
});

let pop_vote = {}; 
d3.csv('https://raw.githubusercontent.com/rmlovell/2020ElectionAnalysis/main/Datasets/pop_vote_data.csv', function(d){
  console.log(d);
  for (let i = 0; i < d.length; i++){
    pop_vote[d[i].st] = {"D": [d[i].dem_votes, d[i].dem_percent], "R": [d[i].rep_votes, d[i].dem_percent], "prop" : d[i].prop};
  }
});

let vote_counts = {};

d3.csv('https://raw.githubusercontent.com/rmlovell/2020ElectionAnalysis/main/Datasets/pop_vote_data.csv', function(d){
  for (let i = 0; i < d.length; i++){
    vote_counts[d[i].st] = {"D" : d[i].dem_votes, "R" : d[i].rep_votes};
  }
});

let likes = {};
d3.csv('https://raw.githubusercontent.com/rmlovell/2020ElectionAnalysis/main/Datasets/likes.csv', function(d){
  for (let i = 0; i < d.length; i++){
   
    likes[d[i].st] = {"D" : d[i].likes_x, "R" : d[i].likes_y, "percent" : d[i].percent};
  }
});

let retweets = {};
d3.csv('https://raw.githubusercontent.com/rmlovell/2020ElectionAnalysis/main/Datasets/retweet_count.csv', function(d){
  for (let i = 0; i < d.length; i++){
    retweets[d[i].st] = {"D" : d[i].retweet_count_x, "R" : d[i].retweet_count_y, "percent" : d[i].percent};
  }
});

let w = 960;

svg.append("text")
        .attr("x", (w / 2))             
        .attr("y", (20))
        .attr("text-anchor", "middle")  
        .style("font-size", "24px") 
        .style("text-decoration", "underline")  
        .text("2020 US Election Tweets");

d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
  if (error) throw error;

  svg.append("g")
      .attr("class", "states")
      
    .selectAll("path")
    .data(topojson.feature(us, us.objects.states).features)
    .enter()
    .append("path")
    .attr("fill", function(d){
        return d3.interpolateRdBu(tweets[d.id].percent);
      })
    .attr("id", function(d){
      return d.id;
    })
    .attr("d", path)
    .append("title")
			  	.text(function(d) {
			   			return "#biden: " + tweets[d.id]["D"].toString() + ", " + Math.round(tweets[d.id]["percent"]*100, 2).toString() + "% #trump: " + tweets[d.id]["R"].toString() + ", " + Math.round((1-tweets[d.id]["percent"])*100, 2).toString() + "%";
			   		});
             svg.append("path")
      .attr("class", "state-borders")
      .attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));
    
      
      function makePie(svg, dataset, title){
        //Width and height
			var w = 200;
			var h = 200;

			var outerRadius = w / 2;
			var innerRadius = 0;
			var arc = d3.arc()
						.innerRadius(innerRadius)
						.outerRadius(outerRadius);
			var pie = d3.pie();
			
			//Easy colors accessible via a 10-step ordinal scale
			var color = d3.scaleOrdinal()
      .range(["blue", "red"]);
        //Set up groups
			var arcs = svg.selectAll("g.arc")
						  .data(pie(dataset))
						  .enter()
						  .append("g")
						  .attr("class", "arc")
						  .attr("transform", "translate(" + (w/2) + ", 130)");
		
			//Draw arc paths
			arcs.append("path")
			    .attr("fill", function(d, i) {
			    	return color(i);
			    })
          
			    .attr("d", arc)
          ;
			
			//Labels
			arcs.append("text")
			    .attr("transform", function(d) {
			    	return "translate(" + arc.centroid(d) + ")";
			    })
          .style('fill', 'white')
			    .attr("text-anchor", "middle")
			    .text(function(d) {
			    	return d.value;
			    });
        
        svg.append("text")
        .attr("class", "text")
        .attr("x", (w / 2))             
        .attr("y", (20))
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-decoration", "underline")  
        .text(title);
      }
      
    d3.selectAll("path")
			.on("mouseover", function () {
      let id = this.id;
      makePie(svg1, [vote_counts[id]["D"], vote_counts[id]["R"]], "Popular vote");
      makePie(svg2, [tweets[id]["D"], tweets[id]["R"]], "Tweets per party");
      makePie(svg3, [likes[id]["D"], likes[id]["R"]], "Likes per party");
      makePie(svg4, [retweets[id]["D"], retweets[id]["R"]], "Retweets per party");
      })
      .on("mouseout", function(){
        d3.selectAll("g.arc").remove();
        d3.selectAll(".text").remove();
      });
 

  
});
function makeScatterplot(){
  var w = 500;
			var h = 500;
			var padding = 40;
			var r = 5;
			
let dataset = [{"stusps":"AZ","prop":0.5,"percent":0.5198,"num_tweets":3334},{"stusps":"FL","prop":0.48,"percent":0.4505,"num_tweets":11789},{"stusps":"GA","prop":0.51,"percent":0.5298,"num_tweets":4672},{"stusps":"IA","prop":0.46,"percent":0.4804,"num_tweets":281},{"stusps":"MI","prop":0.52,"percent":0.4702,"num_tweets":2082},{"stusps":"MN","prop":0.54,"percent":0.5143,"num_tweets":1571},{"stusps":"NV","prop":0.51,"percent":0.4996,"num_tweets":3443},{"stusps":"NH","prop":0.54,"percent":0.56,"num_tweets":50},{"stusps":"NC","prop":0.49,"percent":0.4531,"num_tweets":2302},{"stusps":"OH","prop":0.46,"percent":0.6234,"num_tweets":4134},{"stusps":"PA","prop":0.51,"percent":0.5063,"num_tweets":6129},{"stusps":"TX","prop":0.47,"percent":0.4718,"num_tweets":14119},{"stusps":"WI","prop":0.5,"percent":0.5798,"num_tweets":990},{"stusps":"AL","prop":0.37,"percent":0.4842,"num_tweets":568},{"stusps":"AK","prop":0.45,"percent":0.5789,"num_tweets":209},{"stusps":"AR","prop":0.36,"percent":0.4925,"num_tweets":134},{"stusps":"CA","prop":0.65,"percent":0.4652,"num_tweets":34168},{"stusps":"CO","prop":0.57,"percent":0.4178,"num_tweets":2748},{"stusps":"CT","prop":0.6,"percent":0.4264,"num_tweets":333},{"stusps":"DE","prop":0.6,"percent":0.8485,"num_tweets":99},{"stusps":"DC","prop":0.95,"percent":0.4188,"num_tweets":15896},{"stusps":"HI","prop":0.65,"percent":0.3378,"num_tweets":592},{"stusps":"ID","prop":0.34,"percent":0.3397,"num_tweets":474},{"stusps":"IL","prop":0.58,"percent":0.4397,"num_tweets":7892},{"stusps":"IN","prop":0.42,"percent":0.4352,"num_tweets":1397},{"stusps":"KS","prop":0.43,"percent":0.4276,"num_tweets":304},{"stusps":"KY","prop":0.37,"percent":0.412,"num_tweets":733},{"stusps":"LA","prop":0.41,"percent":0.4416,"num_tweets":1207},{"stusps":"ME","prop":0.55,"percent":0.2857,"num_tweets":28},{"stusps":"MD","prop":0.67,"percent":0.4481,"num_tweets":1455},{"stusps":"MA","prop":0.67,"percent":0.5206,"num_tweets":4524},{"stusps":"MS","prop":0.41,"percent":0.5839,"num_tweets":161},{"stusps":"MO","prop":0.42,"percent":0.4448,"num_tweets":1902},{"stusps":"MT","prop":0.41,"percent":0.6627,"num_tweets":83},{"stusps":"NE","prop":0.4,"percent":0.5519,"num_tweets":270},{"stusps":"NJ","prop":0.58,"percent":0.5117,"num_tweets":858},{"stusps":"NM","prop":0.55,"percent":0.4989,"num_tweets":463},{"stusps":"NY","prop":0.62,"percent":0.4883,"num_tweets":36728},{"stusps":"ND","prop":0.33,"percent":0.7436,"num_tweets":39},{"stusps":"OK","prop":0.33,"percent":0.5026,"num_tweets":569},{"stusps":"OR","prop":0.58,"percent":0.3428,"num_tweets":2926},{"stusps":"RI","prop":0.6,"percent":0.4828,"num_tweets":145},{"stusps":"SC","prop":0.44,"percent":0.5035,"num_tweets":564},{"stusps":"TN","prop":0.38,"percent":0.4365,"num_tweets":2252},{"stusps":"UT","prop":0.4,"percent":0.5661,"num_tweets":590},{"stusps":"VT","prop":0.68,"percent":0.2536,"num_tweets":138},{"stusps":"VA","prop":0.55,"percent":0.4166,"num_tweets":1085},{"stusps":"WA","prop":0.6,"percent":0.4788,"num_tweets":3471},{"stusps":"WV","prop":0.3,"percent":0.6216,"num_tweets":37},{"stusps":"WY","prop":0.28,"percent":0.3393,"num_tweets":56}];

			var xScale = d3.scaleLinear()
								 .domain([0, 1])
								 .range([padding, (w - padding)]);

			var yScale = d3.scaleLinear()
								 .domain([0, 1])
								 .range([(h - padding), padding]);

								 

			//Define X axis
			var xAxis = d3.axisBottom()
							  .scale(xScale)
							  .ticks(9);

			//Define Y axis
			var yAxis = d3.axisLeft()
							  .scale(yScale)
							  .ticks(9);

			//Create circles
			svg5.selectAll("circle")
			   .data(dataset)
			   .enter()
			   .append("circle")
			   
			   .attr("cx", function(d) {
			   		return xScale(d.prop);
			   })
			   .attr("cy", function(d) {
			   		return yScale(d.percent);
			   })
			   .attr("r", function(d){
				   return d.num_tweets/1500+5;
				})
				.attr("fill", "steelblue")
				.attr("opacity", .6)
        .append("title")
			  	.text(function(d) {
            return d.stusps;
          });
			
			//Create X axis
			svg5.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0" + "," + (h-padding) + ")")
				.call(xAxis);
			
			//Create Y axis
			svg5.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + ((padding)) + "," +  "0)")
				.call(yAxis);
}
makeScatterplot();
</script>
</body>
</html>